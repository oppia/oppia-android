name: Build environment setup
description: Sets up the Android & Bazel build environments for Oppia Android
runs:
  using: composite
  steps:
    - name: Set up JDK 9
      uses: actions/setup-java@v1
      with:
        java-version: 9

    - name: Check Java version & path
      run: |
        which java
        java -version
        echo "Java home: $JAVA_HOME"
        $JAVA_HOME/bin/java -version

    - name: Set up Bazel
      uses: abhinavsingh/setup-bazel@v3
      with:
        version: 4.0.0

    - name: Configure Bazel to use JDK 9 for building
      run: |
        echo "build --java_language_version=9" >> $HOME/.bazelrc

    - name: Configure Bazel to use specific sandbox tmpfs
      run: |
        echo "build --enable_platform_specific_config" >> $HOME/.bazelrc
        echo "build:linux --sandbox_tmpfs_path=/tmp" >> $HOME/.bazelrc

    - name: Set up Oppia Bazel Android Tools
      run: |
        mkdir $HOME/opensource
        cd $HOME/opensource
        git clone https://github.com/oppia/oppia-bazel-tools
        echo build --override_repository=android_tools="$(cd "$(dirname "$HOME/opensource/oppia-bazel-tools")"; pwd)/$(basename "$HOME/opensource/oppia-bazel-tools")" >> $HOME/.bazelrc
        echo build --android_databinding_use_androidx >> $HOME/.bazelrc
